meta {
  name: Register
  type: http
  seq: 1
}

post {
  url: {{baseUrl1}}/auth/register
  body: json
  auth: none
}

body:json {
  {
    "username": "yash123",
    "password": "password123",
    "firstName": "Yash",
    "lastName": "Mishra"
  }
}

script:post-response {
  if (res.status === 200) {
    const response = res.getBody();
    
    // Set the auth token
    if (response.token) {
      bru.setEnvVar("authToken", response.token);
      console.log("✅ Auth token set successfully");
    }
    
    // Extract user ID from token (JWT decode)
    if (response.token) {
      try {
        const tokenParts = response.token.split('.');
        if (tokenParts.length === 3) {
          const payload = JSON.parse(atob(tokenParts[1]));
          if (payload.sub || payload.userId || payload.id) {
            const userId = payload.sub || payload.userId || payload.id;
            bru.setEnvVar("userId", userId);
            console.log("✅ User ID set successfully:", userId);
          }
        }
      } catch (e) {
        console.log("⚠️ Could not extract user ID from token");
      }
    }
    
    console.log("Registration successful!");
    console.log("Display Name:", response.displayName);
  }
}